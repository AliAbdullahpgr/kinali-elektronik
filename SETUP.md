# Kınalı Elektrik - Setup Guide

## Initial Setup

### 1. Install Dependencies
```bash
npm install
```

### 2. Database Setup
```bash
# Push schema to database
npm run db:push

# (Optional) Seed database with placeholder data
npm run db:seed
```

### 3. Environment Variables

Copy `.env.example` to `.env` and fill in the values:

```bash
# Next Auth
AUTH_SECRET="your-secret-here"  # Generated by: npx auth secret
AUTH_TRUST_HOST="true"

# Database
DATABASE_URL="your-database-url"
DATABASE_DIRECT_URL="your-direct-database-url"

# UploadThing
UPLOADTHING_SECRET="your-uploadthing-secret"
UPLOADTHING_APP_ID="your-uploadthing-app-id"
```

### 4. Run Development Server
```bash
npm run dev
```

## First Time Login

**Default Admin Credentials (Placeholder Mode):**
- Email: `admin@kinali.local`
- Password: `admin1234`

**Important:** If you see JWT decryption errors on first run:
1. Clear your browser cookies for `localhost:3000`
2. Or use an incognito/private window
3. This happens when the AUTH_SECRET changes

## Production Deployment

### Vercel Deployment

1. Push code to GitHub
2. Import project in Vercel
3. Set environment variables in Vercel dashboard:
   - `AUTH_SECRET` - Generate with `npx auth secret`
   - `AUTH_TRUST_HOST` - Set to `"true"`
   - `DATABASE_URL` - Your Neon/Postgres connection string
   - `DATABASE_DIRECT_URL` - Your direct database URL
   - `UPLOADTHING_SECRET` - From uploadthing.com
   - `UPLOADTHING_APP_ID` - From uploadthing.com

4. Deploy!

### Environment Variables Notes

- `AUTH_SECRET`: Must be at least 32 characters. Generate with `npx auth secret`
- `AUTH_TRUST_HOST`: Must be `"true"` for production deployments
- `DATABASE_URL`: Use connection pooling URL (with pgbouncer)
- `DATABASE_DIRECT_URL`: Use direct connection URL for migrations

## Troubleshooting

### JWT Session Errors

If you see errors like:
```
[auth][error] JWTSessionError: no matching decryption secret
```

**Solution:** Clear your browser cookies and refresh, or use incognito mode. This happens when the `AUTH_SECRET` changes.

### Build Errors on Windows

If you see EPERM errors during build, the custom Prisma output path has been removed. Just run:
```bash
npm run build
```

### Database Connection Issues

Make sure your `DATABASE_URL` includes `?sslmode=require` for Neon databases:
```
DATABASE_URL="postgresql://user:pass@host/db?sslmode=require"
```

## Project Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── admin/             # Admin panel pages
│   │   ├── login/         # Login page
│   │   ├── products/      # Product management
│   │   └── layout.tsx     # Admin layout with nav
│   ├── kategori/[slug]/   # Category pages
│   ├── urun/[slug]/       # Product detail pages
│   └── layout.tsx         # Root layout
├── server/
│   ├── api/               # tRPC API routes
│   ├── auth/              # NextAuth configuration
│   └── db.ts              # Prisma client
└── styles/                # Global styles

prisma/
└── schema.prisma          # Database schema
```

## Available Scripts

- `npm run dev` - Start development server with Turbopack
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run typecheck` - Run TypeScript type checking
- `npm run db:push` - Push Prisma schema to database
- `npm run db:studio` - Open Prisma Studio (database GUI)
- `npm run db:seed` - Seed database with sample data

## Admin Panel

Access the admin panel at: `http://localhost:3000/admin`

### Features:
- Dashboard with product statistics
- Product management (CRUD)
- Category management
- Image upload via UploadThing
- Session-based authentication
- Auto logout functionality

## Tech Stack

- **Framework:** Next.js 15 (App Router)
- **Language:** TypeScript
- **Styling:** Tailwind CSS 4
- **Database:** PostgreSQL (Neon)
- **ORM:** Prisma
- **API:** tRPC
- **Auth:** NextAuth.js v5
- **File Upload:** UploadThing
- **Deployment:** Vercel
